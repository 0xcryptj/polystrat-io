# Polymarket CLOB API (PASTED)

> Source: user-pasted excerpts (original reference URLs provided but not fetched).

## Central Limit Order Book (CLOB) — Introduction

Welcome to the Polymarket Order Book API! This documentation provides overviews, explanations, examples, and annotations to simplify interaction with the order book. The following sections detail the Polymarket Order Book and the API usage.

### System

Polymarket’s Order Book, or CLOB (Central Limit Order Book), is hybrid-decentralized. It includes an operator for off-chain matching/ordering, with settlement executed on-chain, non-custodially, via signed order messages.

The exchange uses a custom Exchange contract facilitating atomic swaps between binary Outcome Tokens (CTF ERC1155 assets and ERC20 PToken assets) and collateral assets (ERC20), following signed limit orders.

Designed for binary markets, the contract enables complementary tokens to match across a unified order book.

Orders are EIP712-signed structured data. Matched orders have one maker and one or more takers, with price improvements benefiting the taker.

The operator handles off-chain order management and submits matched trades to the blockchain for on-chain execution.

### API

The Polymarket Order Book API enables market makers and traders to programmatically manage market orders. Orders of any amount can be created, listed, fetched, or read from the market order books.

Data includes all available markets, market prices, and order history via REST and WebSocket endpoints.

### Security

Polymarket’s Exchange contract has been audited by Chainsecurity (View Audit).

The operator’s privileges are limited to order matching, non-censorship, and ensuring correct ordering.

Operators can’t set prices or execute unauthorized trades.

Users can cancel orders on-chain independently if trust issues arise.

## Fees

Schedule (subject to change):

- Volume Level: >0 USDC
- Maker Fee Base Rate (bps): 0
- Taker Fee Base Rate (bps): 0

### Overview

Fees apply symmetrically in output assets (proceeds). This symmetry ensures fairness and market integrity.

Fees are calculated differently depending on whether you are buying or selling:

- Selling outcome tokens (base) for collateral (quote):

  `feeQuote = baseRate × min(price, 1 − price) × size`

- Buying outcome tokens (base) with collateral (quote):

  `feeBase = baseRate × min(price, 1 − price) × price × size`

## Authentication

Understanding authentication using Polymarket’s CLOB.

The CLOB uses two levels of authentication: L1 (Private Key) and L2 (API Key).

Authentication is not required to access client public methods and public endpoints.

### Authentication Levels

- L1 Authentication: Use the private key of the user’s account to sign messages
- L2 Authentication: Use API credentials (key, secret, passphrase) to authenticate requests to the CLOB

### L1 Authentication

What is L1?

L1 authentication uses the wallet’s private key to sign an EIP-712 message used in the request header. It proves ownership and control over the private key. The private key stays in control of the user and all trading activity remains non-custodial.

What This Enables:
- Access to L1 methods that create or derive L2 authentication headers.
- Create user API credentials
- Derive existing user API credentials
- Sign/create user’s orders locally

#### CLOB Client (TypeScript/Python)

TypeScript example:

```ts
import { ClobClient } from "@polymarket/clob-client";
import { Wallet } from "ethers"; // v5.8.0

const HOST = "https://clob.polymarket.com";
const CHAIN_ID = 137; // Polygon mainnet

const signer = new Wallet(process.env.PRIVATE_KEY);
const client = new ClobClient(HOST, CHAIN_ID, signer); // Signer enables L1 methods

// Gets API key, or else creates
const apiCreds = await client.createOrDeriveApiKey();

/* apiCreds = {
  "apiKey": "550e8400-e29b-41d4-a716-446655440000",
  "secret": "base64EncodedSecretString",
  "passphrase": "randomPassphraseString"
} */
```

Never commit private keys to version control. Always use environment variables or secure key management systems.

#### REST API (L1)

When making direct REST API calls with L1 authentication, include these headers:

- `POLY_ADDRESS` (required) — Polygon signer address
- `POLY_SIGNATURE` (required) — CLOB EIP-712 signature
- `POLY_TIMESTAMP` (required) — Current UNIX timestamp
- `POLY_NONCE` (required) — Nonce. Default 0

The `POLY_SIGNATURE` is generated by signing an EIP-712 struct (details referenced in docs).

##### Create API Credentials

Create new API credentials for user.

- `POST {clob-endpoint}/auth/api-key`

##### Derive API Credentials

Derive API credentials for user.

- `GET {clob-endpoint}/auth/derive-api-key`

Response:

```json
{ "apiKey": "550e8400-e29b-41d4-a716-446655440000", "secret": "base64EncodedSecretString", "passphrase": "randomPassphraseString" }
```

You’ll need all three values for L2 authentication.

### L2 Authentication

What is L2?

The next level of authentication is called L2, and it consists of the user’s API credentials (apiKey, secret, passphrase) generated from L1 authentication. These are used solely to authenticate requests made to the CLOB API.

Requests are signed using HMAC-SHA256.

What This Enables:
- Access to L2 methods such as posting signed/created orders, viewing open orders, cancelling open orders, getting trades
- Cancel or get user’s open orders
- Check user’s balances and allowances
- Post user’s signed orders

#### REST API (L2)

When making direct REST API calls with L2 authentication, include these headers:

- `POLY_ADDRESS` (required) — Polygon signer address
- `POLY_SIGNATURE` (required) — HMAC signature for request
- `POLY_TIMESTAMP` (required) — Current UNIX timestamp
- `POLY_API_KEY` (required) — User’s API `apiKey` value
- `POLY_PASSPHRASE` (required) — User’s API `passphrase` value

The `POLY_SIGNATURE` for L2 is an HMAC-SHA256 signature created using the user’s API credentials `secret` value.

### Signature Types and Funder

When initializing the L2 client, you must specify your wallet `signatureType` and the funder address which holds the funds:

- EOA (value 0): Standard Ethereum wallet (MetaMask)
- POLY_PROXY (value 1): Proxy wallet used with Magic Link email/Google logins
- GNOSIS_SAFE (value 2): Gnosis Safe multisig proxy wallet (most common)

### Troubleshooting (mentioned)

- Error: `INVALID_SIGNATURE`
- Error: `NONCE_ALREADY_USED`
- Error: Invalid Funder Address
- Lost API credentials but have nonce
- Lost both credentials and nonce

### See Client Methods (mentioned)

- Public Methods — Access market data, orderbooks, and prices.
- L1 Methods — Private key authentication to create or derive API keys (L2 headers).
- L2 Methods — Manage and close orders. Creating orders requires signer.
- Builder Program Methods — Builder-specific operations.

## Orderbook

### Get order book summary

Retrieves the order book summary for a specific token.

#### Endpoint

`GET /book`

Query parameters:
- `token_id` (string, required) — The unique identifier for the token

#### Response (200)

- `market` (string, required) — Market identifier (example is a 0x… hash)
- `asset_id` (string, required) — Asset identifier (example: "1234567890")
- `timestamp` (string<date-time>, required)
- `hash` (string, required)
- `bids` (object[], required) — Array of bid levels (child attrs not included in excerpt)
- `asks` (object[], required) — Array of ask levels (child attrs not included in excerpt)
- `min_order_size` (string, required)
- `tick_size` (string, required)
- `neg_risk` (boolean, required)

### Get multiple order books summaries by request

Retrieves order book summaries for specified tokens via POST request.

#### Endpoint

`POST /books`

Body (application/json):
- array of objects (max length 500)
  - `token_id` (string, required)
  - `side` (enum<string>, optional) — BUY | SELL

#### Response (200)

Successful response contains orderbook summary objects (same shape as `/book` response above).

## Missing details needed to implement read-only orderbook/trades (please paste)

To implement READ-ONLY orderbook + recent trades via REST/WebSocket, we still need:

### Base URL
- Confirm the REST base URL for these endpoints (the docs excerpt shows `HOST = https://clob.polymarket.com` in the client example, but the `/book` docs should specify the REST base URL and any version prefix).

### Orderbook level schema
- The **child attributes** for entries inside `bids[]` and `asks[]` (price/size field names and units).

### Trades
- The exact **recent trades** endpoint(s) (path + params) and their full response schema.

### ID mapping
- Clarification of which identifier maps from Gamma markets to CLOB:
  - the exact format of `clobTokenIds` in Gamma responses
  - whether `token_id` corresponds to those IDs directly
